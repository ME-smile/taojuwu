<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Hello</title>
    <style>
        .axis text {
            font-family: Arial;
            font-size: 13px;
            color: #333333;
            text-anchor: end;
        }

        .axis path,
        .axis line {
            fill: none;
            stroke: grey;
            stroke-width: 1;
            shape-rendering: crispEdges;
        }

        .textlabel {
            font-family: Arial;
            font-size: 13px;
            color: #333333;
            text-anchor: middle;
        }
    </style>


</head>

<body style="margin:0;">
    <!-- Create a div where the graph will take place -->
    <div id="data" style="width: 100%;min-height: 400px;"></div>

    <script src="https://d3js.org/d3.v5.min.js"></script>
    <!-- <svg width="300" height="200"> </svg> -->
    <script>

        var x_domain = d3.extent(data, function (d) { return 'asixX:' + d.ser1; }),
            y_domain = d3.extent(data, function (d) { return 'asixY:' + d.ser2; });

        // Create 2 datasets
        var data1 = [
            { ser1: 0.3, ser2: 4 },
            { ser1: 2, ser2: 3 },
            { ser1: 3, ser2: 33 },
            { ser1: 4, ser2: 44 },
            { ser1: 5, ser2: 55 },
            { ser1: 6, ser2: 2 },
            { ser1: 8, ser2: 11 }
        ];

        var data2 = [
            { ser1: 1, ser2: 7 },
            { ser1: 4, ser2: 1 },
            { ser1: 6, ser2: 8 }
        ];

        // set the dimensions and margins of the graph

        var dataEl = document.getElementById('data');
        var w = dataEl.offsetWidth;
        var h = window.innerHeight;
        dataEl.style.height = h;

        var margin = { top: 20, right: 30, bottom: 50, left: 50 },
            width = w - margin.left - margin.right,
            height = h - margin.top - margin.bottom;

        // append the svg object to the body of the page
        var svg = d3.select("#data")
            .append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform",
                "translate(" + margin.left + "," + margin.top + ")")
            .attr("viewBox", "0 0 " + width + " " + height);

        svg.append("g")
            .attr("class", "d3-dots");

        // Initialise a X axis:
        var x = d3.scaleLinear().range([0, width]);
        var xAxis = d3.axisBottom().scale(x);
        svg.append("g")
            .attr("transform", "translate(0," + height + ")")
            .attr("class", "myXaxis")

        // Initialize an Y axis
        var y = d3.scaleLinear().range([height, 0]);
        var yAxis = d3.axisLeft().scale(y);
        svg.append("g")
            .attr("class", "myYaxis")

	var lineColor = "steelblue";

	var upSchema = function(color)
	{
		lineColor = color;
	};
        var handleData =  function(data, xLabel, yLabel) {
	
            if (typeof xLabel == 'undefined') {
                xLabel = '';
            }
            if (typeof yLabel == 'undefined') {
                yLabel = '';
            }

            var formatDay = function(d) {
              var xArr = data.map(function(it){return it.ser1;});
              var i = xArr.indexOf(d);
              var it = data[i];
              if(typeof it != 'undefined' && typeof it.xLabel != 'undefined')
                return it.xLabel;
              return typeof it == 'undefined' || typeof it.ser1 == 'undefined' ? '' : it.ser1;
            }
            xAxis.tickFormat(formatDay);
            // Create the X axis:
            x.domain([0, d3.max(data, function (d) { return d.ser1 })]);
            svg.selectAll(".myXaxis").transition()
                .duration(3000)
                .call(xAxis);

            
            // create the Y axis
            y.domain([0, d3.max(data, function (d) { return d.ser2 })]);
            svg.selectAll(".myYaxis")
                .transition()
                .duration(3000)
                .call(yAxis);

            // Create a update selection: bind to the new data
            var u = svg.selectAll(".lineTest")
                .data([data], function (d) { return d.ser1 });

            // Updata the line
            u
                .enter()
                .append("path")
                .attr("class", "lineTest")
                .merge(u)
                .transition()
                .duration(3000)
                .attr("d", d3.line()
                    .x(function (d) { return x(d.ser1); })
                    .y(function (d) { return y(d.ser2); }))
                .attr("fill", "none")
                .attr("stroke", lineColor)
                .attr("stroke-width", 2.5);

            u.exit()
                .remove();


            // text label for the x axis
	    
		svg.selectAll('.xLbl').remove();
		svg.append("text")
		.attr('class','xLbl')
                .attr("transform",
                    "translate(" + (width / 2) + " ," +
                    (height + margin.top + 20) + ")")
                .style("text-anchor", "middle")
                .text(xLabel);
		
            // Add the text label for the Y axis
		svg.selectAll('.yLbl').remove();
            svg.append("text")
                .attr('class', 'yLbl')
		.attr("transform", "rotate(-90)")
                .attr("y", 0 - margin.left)
                .attr("x", 0 - (height / 2))
                .attr("dy", "1em")
                .style("text-anchor", "middle")
                .text(yLabel);

            // Group dots
            var points
                = svg.selectAll('.d3-dot')
                    .data(data);
            points.enter()
                .append('text')
                .attr('class', 'd3-dot')
                .merge(points)
                .text(function (d, i) {
                    return typeof d.value != 'undefined' ? d.value : d.ser2;
                }).attr("transform", function (d) {
                    return "translate(" + x(d.ser1) + "," + y(d.ser2) + ")";
                }
                ).attr('font-size',14);
            points.exit()
                .remove();

        }

        // At the beginning, I run the update function on the first dataset:
        handleData(data1, '时间', '数量');

        //setTimeout(() => {
        //    handleData(data2, 'A', 'B');
        // }, 2000);
    </script>
</body>

</html>
