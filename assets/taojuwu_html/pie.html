<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Hello</title>
    <style>
        .arc text {
            font: 10px sans-serif;
            text-anchor: middle;
        }

        .arc path {
            stroke: #fff;
        }

        .title {
            fill: teal;
            font-weight: bold;
        }
    </style>


</head>

<body style="margin:0;">
    <!-- Create a div where the graph will take place -->
    <div id="data" style="width: 100%;min-height:400px;"></div>

    <script src="https://d3js.org/d3.v5.min.js"></script>
    <!-- <svg width="300" height="200"> </svg> -->
    <script>
        var dataEl = document.getElementById('data');
        var w = dataEl.offsetWidth;
        var h = window.innerHeight;
        dataEl.style.height = h;


        var width = w,
            height = h,
            margin = 1;

        // The radius of the pieplot is half the width or half the height (smallest one). I subtract a bit of margin.
        var radius = Math.min(width, height) / 2 - margin

        var svg = d3.select("#data")
            .append("svg")
            .attr("width", width)
            .attr("height", height)
            .append("g")
            .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");




        var arcGenerator = d3.arc()
            .innerRadius(0)
            .outerRadius(radius);

        var key = function (d) {
            return d.data.key;
        };


        var colorSchema = ['#4daf4a', '#ff7f00', '#984ea3', '#e41a1c', '#dcedca'];


        // Create dummy data
        var data1 = { a: 9, b: 20, c: 30, d: 8, e: 12 }
        var data2 = { a: 22, b: 22, c: 22, d: 22, e: 22 }
        console.log('data', data1);

	var upSchema = function (data)
{
	colorSchema = data;
};

        var handleData = function (data) {
            // set the color scale
            var color = d3.scaleOrdinal()
                .domain(data)
                .range(colorSchema);
            // Compute the position of each group on the pie:
            var pie = d3.pie()
                .value(function (d) { return d.value; })
                .sort(function (a, b) { console.log(a); return d3.ascending(a.key, b.key); }) // This make sure that group order remains the same in the pie chart
            var data_ready = pie(d3.entries(data))

            // map to data
            var u = svg.selectAll("mySlices")
                .data(data_ready)

            // Build the pie chart: Basically, each part of the pie is a path that we build using the arc function.
            u
                .enter()
                .append('path')
                .merge(u)
                .transition()
                .duration(1000)
                .attr('d', d3.arc()
                    .innerRadius(0)
                    .outerRadius(radius)
                )
                .attr('fill', function (d) { return (color(d.data.key)) })
                .attr("stroke", "white")
                .style("stroke-width", "2px")
                .style("opacity", 1)

            u
                .exit()
                .remove()




            var label = d3.arc()
                .outerRadius(radius*0.59)
                .innerRadius(radius * 0.2);

            var text = svg.selectAll("mySlices")
                .data(data_ready);
            
	    text
                .enter()
                .append('text')
                .text(function (d) { var labels = d.data.key.split(','); 
		return labels[0];
		})
                .attr("transform", function (d) { return "translate(" + label.centroid(d) + ")"; })
		.attr('dy','-7')
	        .style('fill', 'white')
                .style("font-size", 11);

	
	    text
                .enter()
                .append('text')
                .text(function (d) { var labels = d.data.key.split(','); return labels.length > 1 ? labels[1] : '';})
                .attr("transform", function (d) { return "translate(" + label.centroid(d) + ")"; })
		.attr('dy', '8')
	        .style('fill', 'white')
                .style("font-size", 12);

            text.exit()
                .remove();

        }

        handleData(data1);

        // setTimeout(() => {
        //     handleData(data2);
        // }, 2000);

    </script>
</body>

</html>
